<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="LingChenBill">
  <meta name="keywords" content="">
  <title>Docker Swarm - LingChen&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/dracula.min.css" />


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">




<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>LingChen's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              Home</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              Archives</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">
              <i class="iconfont icon-category-fill"></i>
              Categories</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              Tags</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/Hippopx-desk.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2020-03-20 19:38">
                    March 20, 2020 pm
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    5.4k 字
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    89
                     分钟
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <p>[TOC]</p>
<h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><p>Docker Swarm包含两个方面：一个企业级的Docker安全集群，一个微服务应用编排引擎。</p>
<p>集群方面：Swarm将一个或多个Docker节点组织起来，使得用户能够以集群方式管理它们。<br>Swarm默认内置有加密的分布式集群存储、加密网络、公用TLS、安全集群接入令牌以及一套简化数字证书管理的PKI。用户可以自如地添加或删除节点。</p>
<p>编排方面：Swarm提供了一套丰富的API使得部署和管理复杂的微服务应用变得易如反掌。</p>
<p>Docker Swarm是一个基于Docker引擎之上的独立产品。除了原生Swarm应用，它还可以部署和管理Kubernetes应用。</p>
<p>一个Swarm由一个或多个Docker节点组成。唯一的前提就是要求所有节点通过可靠的网络相连。<br>节点会被配置为管理节点（Manager）或工作节点（Worker）。管理节点负责集群控制面版，进行诸如监控集群状态、分发任务至工作节点等操作。工作节点接收来自管理节点的任务并执行。<br>Swarm的配置和状态信息保存在一套位于所有管理节点上的分布式etcd数据库中。该数据库运行于内存中，并保持数据的最新状态。它几乎不需要任何配置—作为Swarm的一部分被安装，无须管理。</p>
<p>关于应用编排，Swarm中的最小调度单元是服务。当容器被封装在一个服务中时，称之为一个任务或一个副本，服务中增加了诸如扩缩容、滚动升级以及简单回滚等特性。</p>
<h3 id="搭建安全Swarm集群"><a href="#搭建安全Swarm集群" class="headerlink" title="搭建安全Swarm集群"></a>搭建安全Swarm集群</h3><h4 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h4><div class="hljs"><pre><code class="hljs bash">// 1）切换docker源
$ tee /etc/yum.repos.d/docker.repo &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span>
[dockerrepo]
name=Docker Repository
baseurl=https://yum.dockerproject.org/repo/main/centos/<span class="hljs-variable">$releasever</span>/
enabled=1
gpgcheck=1
gpgkey=https://yum.dockerproject.org/gpg
EOF

// 2）安装docker 
$ sudo yum install docker

$ docker --version
Docker version 18.09.9-ce, build 039a7df

// 3) 启动docker
$ sudo systemctl <span class="hljs-built_in">enable</span> docker
$ sudo systemctl start docker
或者
$ sudo service docker start

// 4) 将当前用户加入docker用户组中,需要重新登录才能有效
$ sudo groupadd docker
$ sudo usermod -aG docker <span class="hljs-variable">$USER</span>

// centos 8安装docker
// 删除旧的docker
$ yum remove docker docker-common docker-selinux docker-engine
Repository AppStream is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository extras is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository PowerTools is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository centosplus is listed more than once <span class="hljs-keyword">in</span> the configuration
未找到匹配的参数： docker
未找到匹配的参数： docker-common
未找到匹配的参数： docker-selinux
未找到匹配的参数： docker-engine
没有软件包需要移除。
依赖关系解决。
无需任何处理。
完毕！

// 安装相关依赖
$ yum install -y yum-utils \
device-mapper-persistent-data \
lvm2

// 查看docker版本
yum list docker-ce --showduplicates | sort -r
...

// 安装docker
$ yum install docker-ce
// 出错一
Repository AppStream is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository extras is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository PowerTools is listed more than once <span class="hljs-keyword">in</span> the configuration
Repository centosplus is listed more than once <span class="hljs-keyword">in</span> the configuration
上次元数据过期检查：0:01:13 前，执行于 2020年03月28日 星期六 21时52分31秒。
错误：
 问题: package docker-ce-3:19.03.8-3.el7.x86_64 requires containerd.io &gt;= 1.2.2-3, but none of the providers can be installed
  - cannot install the best candidate <span class="hljs-keyword">for</span> the job
  - package containerd.io-1.2.10-3.2.el7.x86_64 is excluded
  - package containerd.io-1.2.13-3.1.el7.x86_64 is excluded
  - package containerd.io-1.2.2-3.3.el7.x86_64 is excluded
  - package containerd.io-1.2.2-3.el7.x86_64 is excluded
  - package containerd.io-1.2.4-3.1.el7.x86_64 is excluded
  - package containerd.io-1.2.5-3.1.el7.x86_64 is excluded
  - package containerd.io-1.2.6-3.3.el7.x86_64 is excluded
(尝试添加 <span class="hljs-string">&#x27;--skip-broken&#x27;</span> 来跳过无法安装的软件包 或 <span class="hljs-string">&#x27;--nobest&#x27;</span> 来不只使用最佳选择的软件包)

// 需要安装containerd.io，
// 我们可以到这个网站https://download.docker.com/linux/centos/7/x86_64/stable/Packages/，
// 找到最新的去安装，可以手动浏览器下载，快
$ dnf install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm

$ yum install docker-ce docker-ce-cli

// centos 8默认已经安装好Python3和pip3
$ pip3 -V
pip 9.0.3 from /usr/lib/python3.6/site-packages (python 3.6)

$ pip3 install docker-compose
$ docker-compose version
docker-compose version 1.25.4, build unknown
docker-py version: 4.2.0
CPython version: 3.6.8
OpenSSL version: OpenSSL 1.1.1c FIPS  28 May 2019

// 修改Docker下载源
// 登录阿里云：https://cr.console.aliyun.com/cn-hangzhou/mirrors。最后一栏就是镜像加速器。会有自己的镜像加速器地址。
$ sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span>
&gt; &#123;
&gt;   <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://aorfq0az.mirror.aliyuncs.com&quot;</span>]
&gt; &#125;
&gt; EOF
&#123;
  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://aorfq0az.mirror.aliyuncs.com&quot;</span>]
&#125;
$ ls
daemon.json  key.json
<span class="hljs-comment"># systemctl daemon-reload</span>
<span class="hljs-comment"># systemctl restart docker</span></code></pre></div>

<h4 id="初始化Swarm"><a href="#初始化Swarm" class="headerlink" title="初始化Swarm"></a>初始化Swarm</h4><p>初始化第一个管理节点 &gt; 加入额外的管理节点 &gt; 加入工作节点 &gt; 完成</p>
<p>单引擎（Single-Engine）模式：不包含在任何Swarm中的Docker节点。一旦被加入Swarm集群，则切换为Swarm模式。</p>
<div class="hljs"><pre><code class="hljs bash">$ docker swarm init \
&gt; --advertise-addr 172.xxx.xxx.xxx:2377 \
&gt; --listen-addr 172.xxx.xxx.xxx:2377
Swarm initialized: current node (ee70iiqr4suz0iry3uvtu2fvl) is now a manager.

To add a worker to this swarm, run the following <span class="hljs-built_in">command</span>:

    docker swarm join --token SWMTKN-1-1fmkohiw5wn4eleb0frcuv4guzdwbqpmvco7vc0hvfvyz1a1fi-7do8xf8my3cjejp10dohwm9t8 172.xxx.xxx.xxx:2377

To add a manager to this swarm, run <span class="hljs-string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.</code></pre></div>

<p>docker swarm init会通知Docker来初始化一个新的Swarm，并将自身设置为第一个管理节点。同时也会使该节点开启Swarm模式。<br>–advertise-addr指定其他节点用来连接到当前管理节点的IP和端口。<br>–listen-addr指定用于承载Swarm流量的IP和端口。<br>Swarm模式下的操作默认运行于2337端口，虽然它是可配置的，但2377/tcp是用于客户端与Swarm进行安全（Https）通信的约定俗成的端口配置。</p>
<h4 id="列出Swarm中的节点"><a href="#列出Swarm中的节点" class="headerlink" title="列出Swarm中的节点"></a>列出Swarm中的节点</h4><p><code>docker node ls</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
ee70iiqr4suz0iry3uvtu2fvl *   ip-xxx-xxx-xxx-xxx.ap-northeast-1.compute.internal   Ready               Active              Leader              18.09.9-ce</code></pre></div>

<p>此时ip-xxx-xxx-xxx-xxx.ap-northeast-1.compute.internal是Swarm中唯一的节点，并且作为Leader列出。</p>
<h4 id="添加工作和管理节点"><a href="#添加工作和管理节点" class="headerlink" title="添加工作和管理节点"></a>添加工作和管理节点</h4><div class="hljs"><pre><code class="hljs bash">$ docker swarm join-token worker
To add a worker to this swarm, run the following <span class="hljs-built_in">command</span>:

    docker swarm join --token SWMTKN-1-1fmkohiw5wn4eleb0frcuv4guzdwbqpmvco7vc0hvfvyz1a1fi-7do8xf8my3cjejp10dohwm9t8 172.xxx.xxx.xxx:2377

$ docker swarm join-token manager
To add a manager to this swarm, run the following <span class="hljs-built_in">command</span>:

    docker swarm join --token SWMTKN-1-1fmkohiw5wn4eleb0frcuv4guzdwbqpmvco7vc0hvfvyz1a1fi-1d4p1rhwnb2nxn21kqoirftn8 172.xxx.xxx.xxx:2377</code></pre></div>

<p>工作节点和管理节点的接入命令中使用的接入Token是不同的。一个节点是作为工作节点还是管理节点接入，完全依赖于使用了哪个Token。</p>
<div class="hljs"><pre><code class="hljs bash">// 添加工作节点
$ docker swarm join \
&gt; --token SWMTKN-1-1fmkohiw5wn4eleb0frcuv4guzdwbqpmvco7vc0hvfvyz1a1fi-7do8xf8my3cjejp10dohwm9t8 172.xxx.xxx.221:2377 \
&gt; --advertise-addr 172.xxx.xxx.57:2377 \
&gt; --listen-addr 172.xxx.xxx.57:2377
This node joined a swarm as a worker.

// 添加管理节点
$ docker swarm join \
&gt; --token SWMTKN-1-1fmkohiw5wn4eleb0frcuv4guzdwbqpmvco7vc0hvfvyz1a1fi-1d4p1rhwnb2nxn21kqoirftn8 172.xxx.xxx.221:2377 \
&gt; --advertise-addr 172.xxx.xxx.90:2377 \
&gt; --listen-addr 172.xxx.xxx.90:2377
This node joined a swarm as a manager.

// 查看节点
$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
ee70iiqr4suz0iry3uvtu2fvl     ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Ready               Active              Leader              18.09.9-ce
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg *   ip-172-xxx-xxx-90                                    Ready               Active              Reachable           18.09.9-ce</code></pre></div>

<p>一个工作节点，两个管理节点。<br>MANAGER STATUS列显示为Leader或者Reachable，则为管理节点。<br>MANAGER STATUS列<strong>无任何显示</strong>的节点是工作节点。只有在管理节点才能执行docker node ls相关命令。</p>
<h3 id="Swarm管理器高可用性（HA）"><a href="#Swarm管理器高可用性（HA）" class="headerlink" title="Swarm管理器高可用性（HA）"></a>Swarm管理器高可用性（HA）</h3><p>Swarm实现了一种主从方式的多管理节点的HA。<br>通常处于活动状态的管理节点被称为“主节点”（leader）,而主节点也是唯一的一个会对Swarm发送控制命令的节点。<br>只有主节点才会变更配置，或发送任务到工作节点。如果一个备用（非活动）管理节点接收到了Swarm命令，则它会将其转发给主节点。</p>
<p>关于HA，两条最佳实践</p>
<ul>
<li>部署奇数个管理节点</li>
<li>不要部署太多管理节点（建议3个或5个）</li>
</ul>
<p>部署奇数个管理节点有利于减少脑裂（Split-Brain）情况的出现机会。掌握多数管理节点的分区能够继续对集群进行管理。<br>显然将管理节点分布到不同的可用域中是一种不错的实践方式，但是一定要确保它们之间的网络连接是可靠的，否则由于底层网络分区导致的问题将是令人痛苦的！请一定要确保管理节点之间是有高速可靠的网络连接的。</p>
<p>Docker提供了自动锁机制来锁定Swarm，这会强制要求重启的管理节点在提供一个集群解锁码之后才有权从新接入集群。</p>
<h4 id="Swarm加锁"><a href="#Swarm加锁" class="headerlink" title="Swarm加锁"></a>Swarm加锁</h4><p><code>docker swarm update --autolock=true</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker swarm update --autolock=<span class="hljs-literal">true</span>
Swarm updated.
To unlock a swarm manager after it restarts, run the `docker swarm unlock`
<span class="hljs-built_in">command</span> and provide the following key:

    SWMKEY-1-jpphL37czEhKVGXr7u5tAb+kndkA9dd5BUO5LdyF6Gg

Please remember to store this key <span class="hljs-keyword">in</span> a password manager, since without it you
will not be able to restart the manager.

// 重启docker
$ sudo service docker restart
Redirecting to /bin/systemctl restart docker.service
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker node ls
Error response from daemon: Swarm is encrypted and needs to be unlocked before it can be used. Please use <span class="hljs-string">&quot;docker swarm unlock&quot;</span> to unlock it.

// 别的管理节点
$ docker node ls
Error response from daemon: rpc error: code = Unknown desc = The swarm does not have a leader. It<span class="hljs-string">&#x27;s possible that too few managers are online. Make sure more than half of the managers are online.</span></code></pre></div>

<h4 id="Swarm解锁"><a href="#Swarm解锁" class="headerlink" title="Swarm解锁"></a>Swarm解锁</h4><p><code>docker swarm unlock</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker swarm unlock
Please enter unlock key: 
// 解锁key，就是加锁key，要妥善保管

[ec2-user@ip-172-xxx-xxx-221 ~]$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
l90pqzsmj0al5gs7laktshpdv                                                        Unknown             Active                                  
ee70iiqr4suz0iry3uvtu2fvl *   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Ready               Active              Reachable           18.09.9-ce
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg     ip-172-xxx-xxx-90                                    Ready               Active              Leader              18.09.9-ce</code></pre></div>

<h4 id="启动Swarm服务"><a href="#启动Swarm服务" class="headerlink" title="启动Swarm服务"></a>启动Swarm服务</h4><div class="hljs"><pre><code class="hljs bash">$ docker service create --name web-fe \
&gt; -p 8080:8080 \
&gt; --replicas 3 \
&gt; nigelpoulton/pluralsight-docker-ci
iqaqb78ufwhps3ugrm5fsxfo5
overall progress: 3 out of 3 tasks 
1/3: running   [==================================================&gt;] 
2/3: running   [==================================================&gt;] 
3/3: running   [==================================================&gt;] 
verify: Service converged</code></pre></div>

<p>docker service create 命令告知Docker正在声明一个新服务<br>–name 参数将其命名为web-fe<br>-p 参数映射端口<br>–replicas 参数告知Docker应该总是有几个此服务的副本</p>
<p>启动的服务都会被Swarm待续监控—Swarm会在后台进行轮训检查（Reconciliation Loop），来持续比较服务的实际状态和期望状态是否一致。若不一致，Swarm会使其一致。</p>
<p>查看服务</p>
<p><code>docker service ls</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                                       PORTS
iqaqb78ufwhp        web-fe              replicated          3/3                 nigelpoulton/pluralsight-docker-ci:latest   *:8080-&gt;8080/tcp</code></pre></div>

<p>查看状态</p>
<p><code>docker service ps web-fe</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker service ps web-fe
ID                  NAME                IMAGE                                       NODE                                               DESIRED STATE       CURRENT STATE            ERROR               PORTS
davkzelaad5o        web-fe.1            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 20 minutes ago                       
y7tw6ryd2vw1        web-fe.2            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-90                                    Running             Running 20 minutes ago                       
lkbh8k5t2lus        web-fe.3            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 20 minutes ago</code></pre></div>

<p>docker service ps <service-name or serviceid>命令可以查看服务副本列表及各副本的状态。</service-name></p>
<p>查看详细状态</p>
<p><code>docker service inspect --pretty web-fe</code></p>
<div class="hljs"><pre><code class="hljs ba">$ docker service inspect --pretty web-fe

ID:             iqaqb78ufwhps3ugrm5fsxfo5
Name:           web-fe
Service Mode:   Replicated
 Replicas:      3
Placement:
UpdateConfig:
 Parallelism:   1
 On failure:    pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Update order:      stop-first
RollbackConfig:
 Parallelism:   1
 On failure:    pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Rollback order:    stop-first
ContainerSpec:
 Image:         nigelpoulton&#x2F;pluralsight-docker-ci:latest@sha256:61bc64850a5f2bfbc65967cc33feaae8a77c8b49379c55aaf05bb02dcee41451
 Init:          false
Resources:
Endpoint Mode:  vip
Ports:
 PublishedPort &#x3D; 8080
  Protocol &#x3D; tcp
  TargetPort &#x3D; 8080
  PublishMode &#x3D; ingress</code></pre></div>

<p>服务的默认复制模式是副本模式，这种模式会部署期望数量的服务副本，并尽可能均匀地将各个副本分布在整个集群上中<br>全局模式—在这种模式下，每个节点仅运行一个副本。</p>
<h4 id="服务的扩缩容"><a href="#服务的扩缩容" class="headerlink" title="服务的扩缩容"></a>服务的扩缩容</h4><p><code>docker service scale web-fe=10</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker service scale web-fe=5
// 扩容到5个副本数
web-fe scaled to 5
overall progress: 5 out of 5 tasks 
1/5: running   [==================================================&gt;] 
2/5: running   [==================================================&gt;] 
3/5: running   [==================================================&gt;] 
4/5: running   [==================================================&gt;] 
5/5: running   [==================================================&gt;] 
verify: Service converged 
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                                       PORTS
iqaqb78ufwhp        web-fe              replicated          5/5                 nigelpoulton/pluralsight-docker-ci:latest   *:8080-&gt;8080/tcp
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ps web-fe
ID                  NAME                IMAGE                                       NODE                                               DESIRED STATE       CURRENT STATE               ERROR               PORTS
davkzelaad5o        web-fe.1            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running about an hour ago                       
y7tw6ryd2vw1        web-fe.2            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-90                                    Running             Running about an hour ago                       
lkbh8k5t2lus        web-fe.3            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running about an hour ago                       
i7s9lrds3ek8        web-fe.4            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 30 seconds ago                          
2fdleu3jx0sd        web-fe.5            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 30 seconds ago</code></pre></div>

<p>缩容</p>
<div class="hljs"><pre><code class="hljs bash">$ docker service scale web-fe=3
// 调整数字大小，可以缩容
web-fe scaled to 3
overall progress: 3 out of 3 tasks 
1/3: running   [==================================================&gt;] 
2/3: running   [==================================================&gt;] 
3/3: running   [==================================================&gt;] 
verify: Service converged 
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                                       PORTS
iqaqb78ufwhp        web-fe              replicated          5/3                 nigelpoulton/pluralsight-docker-ci:latest   *:8080-&gt;8080/tcp
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ps web-fe
ID                  NAME                IMAGE                                       NODE                                               DESIRED STATE       CURRENT STATE               ERROR               PORTS
davkzelaad5o        web-fe.1            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running about an hour ago                       
y7tw6ryd2vw1        web-fe.2            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-90                                    Running             Running about an hour ago                       
lkbh8k5t2lus        web-fe.3            nigelpoulton/pluralsight-docker-ci:latest   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running about an hour ago</code></pre></div>

<p>删除服务</p>
<p><code>docker service rm web-fe</code></p>
<h4 id="滚动升级"><a href="#滚动升级" class="headerlink" title="滚动升级"></a>滚动升级</h4><p>创建网络（Overlay Network）</p>
<p><code>docker network create -d overlay uber-net</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker network create -d overlay uber-net
y0w8j0n8xairlub0qj5a621p2
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
y0w8j0n8xair        uber-net            overlay             swarm</code></pre></div>

<p>创建一个新的服务，并将其接入uber-net网络</p>
<div class="hljs"><pre><code class="hljs bash">$ docker service create --name uber-svc \
&gt; --network uber-net \
&gt; -p 80:80 --replicas 6 \
&gt; nigelpoulton/tu-demo:v1
xlp3rupt5rjptzjjipd4vofmu
overall progress: 6 out of 6 tasks 
1/6: running   [==================================================&gt;] 
2/6: running   [==================================================&gt;] 
3/6: running   [==================================================&gt;] 
4/6: running   [==================================================&gt;] 
5/6: running   [==================================================&gt;] 
6/6: running   [==================================================&gt;] 
verify: Service converged 
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                     PORTS
xlp3rupt5rjp        uber-svc            replicated          6/6                 nigelpoulton/tu-demo:v1   *:80-&gt;80/tcp
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ps uber-svc
ID                  NAME                IMAGE                     NODE                                               DESIRED STATE       CURRENT STATE            ERROR               PORTS
jl7o8inw4hiw        uber-svc.1          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 44 seconds ago                       
mcd0kovmmfm2        uber-svc.2          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 44 seconds ago                       
pq8oxkxvbvkn        uber-svc.3          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-90                                    Running             Running 44 seconds ago                       
surhy6sjwe2e        uber-svc.4          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 44 seconds ago                       
iq8pxhzrkl07        uber-svc.5          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 44 seconds ago                       
ovynni3in53e        uber-svc.6          nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-90                                    Running             Running 44 seconds ago</code></pre></div>

<p>–network 参数声明所有的副本都连接到uber-net网络。</p>
<p>此时输入Swarm应用访问地址</p>
<p><img src="/.io//1.png" srcset="/img/loading.gif" alt="访问Swarm应用"></p>
<h4 id="滚动更新"><a href="#滚动更新" class="headerlink" title="滚动更新"></a>滚动更新</h4><p>将新镜像更新到Swarm中时采用一种阶段性的方式—每次更新两个副本，并且中间间隔20s。</p>
<p><code>docker service update</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker service update --image nigelpoulton/tu-demo:v2 \
&gt; --update-parallelism 2 \
&gt; --update-delay 20s uber-svc
uber-svc
overall progress: 6 out of 6 tasks 
1/6: running   [==================================================&gt;] 
2/6: running   [==================================================&gt;] 
3/6: running   [==================================================&gt;] 
4/6: running   [==================================================&gt;] 
5/6: running   [==================================================&gt;] 
6/6: running   [==================================================&gt;] 
verify: Service converged 

$ docker service ps uber-svc
ID                  NAME                IMAGE                     NODE                                               DESIRED STATE       CURRENT STATE            ERROR               PORTS
mgp2tlukas59        uber-svc.1          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 3 minutes ago                        
jl7o8inw4hiw         \_ uber-svc.1      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Shutdown            Shutdown 3 minutes ago                       
gh7qw0m6obzc        uber-svc.2          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 4 minutes ago                        
mcd0kovmmfm2         \_ uber-svc.2      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Shutdown            Shutdown 4 minutes ago                       
js42qhpdcig0        uber-svc.3          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-90                                    Running             Running 4 minutes ago                        
pq8oxkxvbvkn         \_ uber-svc.3      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-90                                    Shutdown            Shutdown 4 minutes ago                       
pc7e8bqql86t        uber-svc.4          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Running             Running 4 minutes ago                        
surhy6sjwe2e         \_ uber-svc.4      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Shutdown            Shutdown 4 minutes ago                       
nrc546s3y5dg        uber-svc.5          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Running             Running 3 minutes ago                        
iq8pxhzrkl07         \_ uber-svc.5      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Shutdown            Shutdown 3 minutes ago                       
qs90nd4litg6        uber-svc.6          nigelpoulton/tu-demo:v2   ip-172-xxx-xxx-90                                    Running             Running 4 minutes ago                        
ovynni3in53e         \_ uber-svc.6      nigelpoulton/tu-demo:v1   ip-172-xxx-xxx-90                                    Shutdown            Shutdown 4 minutes ago</code></pre></div>

<p>有的版本号有v1和v2，滚动更新</p>
<div class="hljs"><pre><code class="hljs bash">$ docker service inspect --pretty uber-svc

ID:             xlp3rupt5rjptzjjipd4vofmu
Name:           uber-svc
Service Mode:   Replicated
 Replicas:      6
UpdateStatus:
 State:         completed
 Started:       11 minutes ago
 Completed:     9 minutes ago
 Message:       update completed
Placement:
UpdateConfig:
 Parallelism:   2
 Delay:         20s
 On failure:    pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Update order:      stop-first
RollbackConfig:
 Parallelism:   1
 On failure:    pause
 Monitoring Period: 5s
 Max failure ratio: 0
 Rollback order:    stop-first
ContainerSpec:
 Image:         nigelpoulton/tu-demo:v2@sha256:d3c0d8c9d5719d31b79cca146025fa7d1de4749fef58a7e038cf0ef2ba5eb74c
 Init:          <span class="hljs-literal">false</span>
Resources:
Networks: uber-net 
Endpoint Mode:  vip
Ports:
 PublishedPort = 80
  Protocol = tcp
  TargetPort = 80
  PublishMode = ingress</code></pre></div>

<p>发现更新时对并行和延迟的设置已经成为服务定义的一部分了。</p>
<p>查看日志</p>
<p><code>docker service logs uber-svc</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker service logs uber-svc
uber-svc.6.ovynni3in53e@ip-172-xxx-xxx-90    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.3.pq8oxkxvbvkn@ip-172-xxx-xxx-90    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.3.pq8oxkxvbvkn@ip-172-xxx-xxx-90    | 10.255.0.3 - - [20/Mar/2020 10:32:19] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -
uber-svc.6.qs90nd4litg6@ip-172-xxx-xxx-90    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.3.js42qhpdcig0@ip-172-xxx-xxx-90    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.4.pc7e8bqql86t@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.1.mgp2tlukas59@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.4.surhy6sjwe2e@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.4.surhy6sjwe2e@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    | 10.255.0.3 - - [20/Mar/2020 10:32:21] <span class="hljs-string">&quot;POST / HTTP/1.1&quot;</span> 200 -
uber-svc.1.jl7o8inw4hiw@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.1.jl7o8inw4hiw@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    | 10.255.0.3 - - [20/Mar/2020 10:28:26] <span class="hljs-string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 -
uber-svc.1.jl7o8inw4hiw@ip-172-xxx-xxx-221.ap-northeast-1.compute.internal    | 10.255.0.5 - - [20/Mar/2020 10:32:14] <span class="hljs-string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 -
uber-svc.2.mcd0kovmmfm2@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.2.mcd0kovmmfm2@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    | 10.255.0.3 - - [20/Mar/2020 10:28:23] <span class="hljs-string">&quot;GET /static/stylesheets/style.css HTTP/1.1&quot;</span> 200 -
uber-svc.2.mcd0kovmmfm2@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    | 10.255.0.5 - - [20/Mar/2020 10:32:08] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -
uber-svc.5.iq8pxhzrkl07@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.5.iq8pxhzrkl07@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    | 10.255.0.3 - - [20/Mar/2020 10:28:22] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -
uber-svc.5.iq8pxhzrkl07@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    | 10.255.0.5 - - [20/Mar/2020 10:32:09] <span class="hljs-string">&quot;GET /static/stylesheets/style.css HTTP/1.1&quot;</span> 200 -
uber-svc.2.gh7qw0m6obzc@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)
uber-svc.5.nrc546s3y5dg@ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    |  * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</code></pre></div>

<h3 id="Swarm删除节点"><a href="#Swarm删除节点" class="headerlink" title="Swarm删除节点"></a>Swarm删除节点</h3><p><code>docker node update --availability drain node_xxx</code></p>
<div class="hljs"><pre><code class="hljs bash">// 查看Swarm节点
$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
ee70iiqr4suz0iry3uvtu2fvl *   ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Ready               Active              Leader              18.09.9-ce
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg     ip-172-xxx-xxx-90                                    Ready               Active              Reachable           18.09.9-ce

// 查看Swarm服务
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE               PORTS
k07efmmmggiz        svc1                replicated          5/5                 nginx:latest        *:5000-&gt;80/tcp

// 查看本节点的服务
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
257e76160609        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   8 minutes ago       Up 8 minutes        80/tcp              svc1.1.yefksat7bl2lyu4sttzefhkkp
2ce656f3d29a        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   8 minutes ago       Up 8 minutes        80/tcp              svc1.3.m48n3y1xhqtczy6p69lmlzr45

// 将节点停用,该节点上的容器会迁移到其他节点
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker node update --availability drain ip-172-xxx-xxx-221.ap-northeast-1.compute.internal
ip-172-31-33-221.ap-northeast-1.compute.internal
[ec2-user@ip-172-xxx-xxx-221 ~]$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

// 将停用的节点容器迁移到其它的节点
[ec2-user@ip-172-xxx-xxx-90 ~]$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
f27d910e8144        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   8 minutes ago       Up 8 minutes        80/tcp              svc1.5.mid0cf32rcmdwzpm627q4juxd
[ec2-user@ip-172-xxx-xxx-90 ~]$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
56751f6cbc14        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   20 seconds ago      Up 14 seconds       80/tcp              svc1.1.mazi7xv1d5o3lw8eqafcnmhnv
883cec81a463        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   20 seconds ago      Up 14 seconds       80/tcp              svc1.3.nc50ulw6mgkpdhot7ac2v2391
f27d910e8144        nginx:latest        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   10 minutes ago      Up 10 minutes       80/tcp              svc1.5.mid0cf32rcmdwzpm627q4juxd</code></pre></div>

<p>降级（在其它管理节点）</p>
<p><code>docker node demote node_xxx</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker node demote ip-172-xxx-xxx-221.ap-northeast-1.compute.internal
Manager ip-172-xxx-xxx-221.ap-northeast-1.compute.internal demoted <span class="hljs-keyword">in</span> the swarm.

$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
ee70iiqr4suz0iry3uvtu2fvl     ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Ready               Drain                                   18.09.9-ce
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg *   ip-172-xxx-xxx-90                                    Ready               Active              Leader              18.09.9-ce</code></pre></div>

<p>停止docker服务（待删除的节点）</p>
<div class="hljs"><pre><code class="hljs bash">$ sudo systemctl stop docker.service
$ ps -ef | grep docker
ec2-user  4789  5324  0 07:56 pts/0    00:00:00 grep --color=auto docker</code></pre></div>

<p>删除节点</p>
<p><code>docker node rm node_xxx</code></p>
<div class="hljs"><pre><code class="hljs bash">$ docker node ls
ID                            HOSTNAME                                           STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
ee70iiqr4suz0iry3uvtu2fvl     ip-172-xxx-xxx-221.ap-northeast-1.compute.internal   Down                Drain                                   18.09.9-ce
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal    Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg *   ip-172-xxx-xxx-90                                    Ready               Active              Leader              18.09.9-ce

[ec2-user@ip-172-xxx-xxx-90 ~]$ docker node rm ip-172-xxx-xxx-221.ap-northeast-1.compute.internal
ip-172-xxx-xxx-221.ap-northeast-1.compute.internal

[ec2-user@ip-172-xxx-xxx-90 ~]$ docker node ls
ID                            HOSTNAME                                          STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
fcjl1u2ogpw3yxsg0l47i7pbf     ip-172-xxx-xxx-57.ap-northeast-1.compute.internal   Ready               Active                                  18.09.9-ce
z9dr0oc0z0oj3wuw38m8ylwqg *   ip-172-xxx-xxx-90                                   Ready               Active              Leader              18.09.9-ce</code></pre></div>

<p><u>ps: 本文摘取于《深入浅出Docker》一书，仅供学习参考</u></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Docker/">Docker</a>
                    
                      <a class="hover-with-bg" href="/tags/Swarm/">Swarm</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/03/21/docker-network/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Docker网络</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/03/19/docker-compose/">
                        <span class="hidden-mobile">Docker Compose部署应用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>






<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Docker Swarm&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>


















<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
